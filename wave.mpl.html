<style type="text/css">
<!--
.Special { color: #c000c0; }
.Constant { color: #c00000; }
.Statement { color: #af5f00; }
-->
</style>
<pre>
<span class="Statement">read</span> <span class="Constant">&quot;/d/bh8/home/arman/FD/FD.mpl&quot;</span><span class="Special">:</span>Clean_FD<span class="Special">()</span><span class="Special">;</span>Make_FD<span class="Special">()</span><span class="Special">;</span>

grid_functions <span class="Special">:=</span> <span class="Special">{</span>f<span class="Special">,</span>f_t<span class="Special">}</span><span class="Special">;</span>

eq1 <span class="Special">:=</span> <span class="Statement">diff</span><span class="Special">(</span>f<span class="Special">(</span>t<span class="Special">,</span>x<span class="Special">)</span><span class="Special">,</span>t<span class="Special">)</span> <span class="Statement">=</span> f_t<span class="Special">(</span>t<span class="Special">,</span>x<span class="Special">)</span><span class="Special">;</span>
eq2 <span class="Special">:=</span> <span class="Statement">diff</span><span class="Special">(</span>f_t<span class="Special">(</span>t<span class="Special">,</span>x<span class="Special">)</span><span class="Special">,</span>t<span class="Special">)</span> <span class="Statement">=</span> <span class="Statement">diff</span><span class="Special">(</span>f<span class="Special">(</span>t<span class="Special">,</span>x<span class="Special">)</span><span class="Special">,</span>x<span class="Special">,</span>x<span class="Special">)</span><span class="Special">;</span>

eq3 <span class="Special">:=</span> <span class="Statement">diff</span><span class="Special">(</span>f<span class="Special">(</span>t<span class="Special">,</span>x<span class="Special">)</span><span class="Special">,</span>t<span class="Special">,</span>t<span class="Special">)</span> <span class="Statement">=</span> <span class="Statement">diff</span><span class="Special">(</span>f<span class="Special">(</span>t<span class="Special">,</span>x<span class="Special">)</span><span class="Special">,</span>x<span class="Special">,</span>x<span class="Special">)</span><span class="Special">;</span>

Gen_Res_Code<span class="Special">(</span><span class="Statement">lhs</span><span class="Special">(</span>eq3<span class="Special">)</span>-<span class="Statement">rhs</span><span class="Special">(</span>eq3<span class="Special">)</span><span class="Special">,</span>input<span class="Statement">=</span><span class="Constant">&quot;c&quot;</span><span class="Special">,</span>proc_name<span class="Statement">=</span><span class="Constant">&quot;ire_f&quot;</span><span class="Special">)</span><span class="Special">;</span>

FD_table<span class="Special">[</span>t<span class="Special">]</span> <span class="Special">:=</span> <span class="Special">[[</span><span class="Constant">0</span><span class="Special">]</span><span class="Special">,</span><span class="Special">[</span><span class="Constant">0</span><span class="Special">,</span><span class="Constant">1</span><span class="Special">]]</span><span class="Special">;</span>
AVGT <span class="Special">:=</span> a -<span class="Statement">&gt;</span> <span class="Special">(</span>   FD<span class="Special">(</span> a<span class="Special">,</span><span class="Special">[</span> <span class="Special">[</span><span class="Constant">1</span><span class="Special">]</span><span class="Special">,</span><span class="Special">[</span><span class="Constant">0</span><span class="Special">]</span> <span class="Special">])</span> + FD<span class="Special">(</span> a<span class="Special">,</span><span class="Special">[</span> <span class="Special">[</span><span class="Constant">0</span><span class="Special">]</span><span class="Special">,</span><span class="Special">[</span><span class="Constant">0</span><span class="Special">]</span> <span class="Special">])</span> <span class="Special">)</span>/<span class="Constant">2</span><span class="Special">;</span>

eq1_D<span class="Special">:=</span> Gen_Sten<span class="Special">(</span><span class="Statement">lhs</span><span class="Special">(</span>eq1<span class="Special">))</span> - AVGT<span class="Special">(</span>Gen_Sten<span class="Special">(</span><span class="Statement">rhs</span><span class="Special">(</span>eq1<span class="Special">)))</span><span class="Special">;</span>
eq2_D<span class="Special">:=</span> Gen_Sten<span class="Special">(</span><span class="Statement">lhs</span><span class="Special">(</span>eq2<span class="Special">))</span> - AVGT<span class="Special">(</span>Gen_Sten<span class="Special">(</span><span class="Statement">rhs</span><span class="Special">(</span>eq2<span class="Special">)))</span><span class="Special">;</span>

s_f<span class="Special">:=</span> <span class="Special">[</span>
  <span class="Special">{</span> i<span class="Statement">=</span><span class="Special">[</span><span class="Constant">1</span><span class="Special">,</span><span class="Constant">1</span><span class="Special">,</span><span class="Constant">1</span><span class="Special">]</span>     <span class="Special">}</span> <span class="Statement">=</span> FD_Periodic<span class="Special">(</span>eq1_D<span class="Special">,</span><span class="Special">{</span>i<span class="Statement">=</span><span class="Constant">1</span><span class="Special">})</span> <span class="Special">,</span>
  <span class="Special">{</span> i<span class="Statement">=</span><span class="Special">[</span><span class="Constant">2</span><span class="Special">,</span>Nx<span class="Constant">-1</span><span class="Special">,</span><span class="Constant">1</span><span class="Special">]</span>  <span class="Special">}</span> <span class="Statement">=</span> eq1_D<span class="Special">,</span>
  <span class="Special">{</span> i<span class="Statement">=</span><span class="Special">[</span>Nx<span class="Special">,</span>Nx<span class="Special">,</span><span class="Constant">1</span><span class="Special">]</span>   <span class="Special">}</span> <span class="Statement">=</span> FD_Periodic<span class="Special">(</span>eq1_D<span class="Special">,</span><span class="Special">{</span>i<span class="Statement">=</span>Nx<span class="Special">})</span>
<span class="Special">]</span><span class="Special">;</span>

s_f_t<span class="Special">:=</span> <span class="Special">[</span>
  <span class="Special">{</span> i<span class="Statement">=</span><span class="Special">[</span><span class="Constant">1</span><span class="Special">,</span><span class="Constant">1</span><span class="Special">,</span><span class="Constant">1</span><span class="Special">]</span>     <span class="Special">}</span> <span class="Statement">=</span> FD_Periodic<span class="Special">(</span>eq2_D<span class="Special">,</span><span class="Special">{</span>i<span class="Statement">=</span><span class="Constant">1</span><span class="Special">})</span><span class="Special">,</span>
  <span class="Special">{</span> i<span class="Statement">=</span><span class="Special">[</span><span class="Constant">2</span><span class="Special">,</span>Nx<span class="Constant">-1</span><span class="Special">,</span><span class="Constant">1</span><span class="Special">]</span>  <span class="Special">}</span> <span class="Statement">=</span> eq2_D<span class="Special">,</span>
  <span class="Special">{</span> i<span class="Statement">=</span><span class="Special">[</span>Nx<span class="Special">,</span>Nx<span class="Special">,</span><span class="Constant">1</span><span class="Special">]</span>   <span class="Special">}</span> <span class="Statement">=</span> FD_Periodic<span class="Special">(</span>eq2_D<span class="Special">,</span><span class="Special">{</span>i<span class="Statement">=</span>Nx<span class="Special">})</span>
<span class="Special">]</span><span class="Special">;</span>
A_Gen_Solve_Code<span class="Special">(</span>s_f<span class="Special">,</span><span class="Special">{</span>f<span class="Special">(</span>n<span class="Constant">+1</span><span class="Special">,</span>i<span class="Special">)}</span><span class="Special">,</span>input<span class="Statement">=</span><span class="Constant">&quot;d&quot;</span><span class="Special">,</span>proc_name<span class="Statement">=</span><span class="Constant">&quot;u_f&quot;</span><span class="Special">,</span>is_periodic<span class="Statement">=</span><span class="Constant">true</span><span class="Special">)</span><span class="Special">;</span>
A_Gen_Solve_Code<span class="Special">(</span>s_f_t<span class="Special">,</span><span class="Special">{</span>f_t<span class="Special">(</span>n<span class="Constant">+1</span><span class="Special">,</span>i<span class="Special">)}</span><span class="Special">,</span>input<span class="Statement">=</span><span class="Constant">&quot;d&quot;</span><span class="Special">,</span>proc_name<span class="Statement">=</span><span class="Constant">&quot;u_f_t&quot;</span><span class="Special">,</span>is_periodic<span class="Statement">=</span><span class="Constant">true</span><span class="Special">)</span><span class="Special">;</span>

A_Gen_Res_Code<span class="Special">(</span>s_f<span class="Special">,</span>input<span class="Statement">=</span><span class="Constant">&quot;d&quot;</span><span class="Special">,</span>proc_name<span class="Statement">=</span><span class="Constant">&quot;res_f&quot;</span><span class="Special">,</span>is_periodic<span class="Statement">=</span><span class="Constant">true</span><span class="Special">)</span><span class="Special">;</span>
A_Gen_Res_Code<span class="Special">(</span>s_f_t<span class="Special">,</span>input<span class="Statement">=</span><span class="Constant">&quot;d&quot;</span><span class="Special">,</span>proc_name<span class="Statement">=</span><span class="Constant">&quot;res_f_t&quot;</span><span class="Special">,</span>is_periodic<span class="Statement">=</span><span class="Constant">true</span><span class="Special">)</span><span class="Special">;</span>

init_f<span class="Special">:=</span>A*<span class="Statement">exp</span><span class="Special">(</span>-<span class="Special">(</span>x-x0<span class="Special">)</span>^<span class="Constant">2</span>/delx^<span class="Constant">2</span><span class="Special">)</span><span class="Special">;</span>
init_f_t<span class="Special">:=</span>idsignum*<span class="Statement">diff</span><span class="Special">(</span>init_f<span class="Special">,</span>x<span class="Special">)</span><span class="Special">;</span>
Gen_Eval_Code<span class="Special">(</span>init_f<span class="Special">,</span>input<span class="Statement">=</span><span class="Constant">&quot;c&quot;</span><span class="Special">,</span>proc_name<span class="Statement">=</span><span class="Constant">&quot;init_f&quot;</span><span class="Special">)</span><span class="Special">;</span>
Gen_Eval_Code<span class="Special">(</span>init_f_t<span class="Special">,</span>input<span class="Statement">=</span><span class="Constant">&quot;c&quot;</span><span class="Special">,</span>proc_name<span class="Statement">=</span><span class="Constant">&quot;init_f_t&quot;</span><span class="Special">)</span><span class="Special">;</span>

</pre>
